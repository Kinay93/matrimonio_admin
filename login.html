<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Login</title>
<style>
/* ---------- BODY & CONTAINER ---------- */
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: #E0FBFC;
    color: #023E3B;
}

.container {
    background: white;
    padding: 30px 40px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
    display: flex;
    flex-direction: column;
}

/* ---------- HEADER ---------- */
header {
    background-color: #2EC4B6;
    color: white;
    text-align: center;
    padding: 15px;
    border-radius: 15px 15px 0 0;
    font-size: 1.5em;
    font-weight: bold;
}

/* ---------- FORM ---------- */
h2 { text-align: center; margin: 20px 0 15px; }

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input[type="email"], input[type="password"], input[type="text"] {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    transition: 0.2s;
}

input:focus {
    border-color: #2EC4B6;
    outline: none;
    box-shadow: 0 0 5px #2EC4B6;
}

/* ---------- BUTTON ---------- */
button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

#loginBtn {
    background-color: #2EC4B6;
    color: white;
}

#loginBtn:hover {
    background-color: #27a19a;
}

/* ---------- MESSAGGI ---------- */
#msg {
    text-align: center;
    margin-bottom: 10px;
    font-weight: bold;
    color: #FF6B6B;
}

/* ---------- SOCIAL BUTTONS ---------- */
.social-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
}

.social-btn button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px;
    font-size: 14px;
    border-radius: 8px;
    color: white;
}

.social-btn button.google { background: #DB4437; }
.social-btn button.facebook { background: #3B5998; }
.social-btn button:hover { opacity: 0.9; }

/* ---------- FOOTER ---------- */
footer {
    margin-top: 15px;
    text-align: center;
    font-size: 0.9em;
}

footer a {
    color: #2EC4B6;
    text-decoration: none;
    font-weight: bold;
    margin: 0 5px;
    transition: 0.2s;
}

footer a:hover { text-decoration: underline; }

@media (max-width:480px){ .container{padding:20px;} }
</style>
</head>
<body>
<div class="container">
<h2>Accedi</h2>
<div id="msg"></div>
<form id="loginForm">
    <label for="identifier">Email o Username</label>
    <input type="text" id="identifier" required>
    <label for="password">Password</label>
    <input type="password" id="password" required>
    <button type="submit" id="loginBtn">Login</button>
</form>
<div class="social-btn">
    <button class="google" id="googleBtn"><img src="https://img.icons8.com/color/20/000000/google-logo.png"/> Google</button>
    <button class="facebook" id="facebookBtn"><img src="https://img.icons8.com/color/20/000000/facebook-new.png"/> Facebook</button>
</div>
<footer>
    <a href="register.html">Non hai un account? Registrati</a> | 
    <a href="#">Password dimenticata?</a>
</footer>
</div>

<script>
const loginForm = document.getElementById('loginForm');
const msg = document.getElementById('msg');

loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.style.color = 'red';

    const identifier = document.getElementById('identifier').value.trim();
    const password = document.getElementById('password').value;

    try {
        const response = await fetch("https://matrimonioapp.ew.r.appspot.com/login", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({identifier, password})
        }).then(res => res.json());

        if(response.success){
            localStorage.setItem("auth_token", response.token);
            localStorage.setItem("admin_username", response.username); // salvo username per il tema
            msg.style.color = 'green';
            msg.textContent = "Login avvenuto con successo!";
            setTimeout(()=>window.location.href='home.html', 1000);
        } else {
            msg.textContent = response.error || "Credenziali non valide";
        }
    } catch(err){
        console.error(err);
        msg.textContent = "Errore di connessione";
    }
});

// Pulsanti OAuth
document.getElementById('googleBtn').addEventListener('click', ()=>{ window.location.href = "/login/google"; });
document.getElementById('facebookBtn').addEventListener('click', ()=>{ window.location.href = "/login/facebook"; });
</script>
</body>
</html>
