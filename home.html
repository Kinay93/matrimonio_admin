<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Home Amministratore</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Lo script della navbar include anche la logica responsive -->
  <script src="navbar.js" defer></script>
  <script src="script.js" defer></script>
</head>
<body>
  <!-- Navbar inclusa dinamicamente -->
  <div id="navbar-placeholder"></div>

  <!-- MAIN CONTENT -->
  <div class="main-content" style="padding:20px;">
    <h2>Benvenuto nella Home!</h2>
    <p>Qui compariranno le informazioni prese da siti esterni (notizie, aggiornamenti, feed, ecc.).</p>
    <div id="feed"><p><i>Caricamento informazioni...</i></p></div>
  </div>

  <script>
    // --- Controllo autenticazione
    async function checkAuth() {
      const token = localStorage.getItem("auth_token");
      const username = localStorage.getItem("admin_username");
      if(!token || !username){
          window.location.href = "login.html";
          return;
      }
      try {
          const res = await fetch("/me", { headers: { "Authorization": "Bearer " + token } });
          const data = await res.json();
          if(!data.success){
              localStorage.removeItem("auth_token");
              localStorage.removeItem("admin_username");
              window.location.href = "login.html";
          }
      } catch(err){
          localStorage.removeItem("auth_token");
          localStorage.removeItem("admin_username");
          window.location.href = "login.html";
      }
    }

    async function caricaFeed() {
      const feed = document.getElementById("feed");
      try {
        const token = localStorage.getItem("auth_token"); // Se in futuro serve auth
        const res = await fetch("https://jsonplaceholder.typicode.com/posts?_limit=3", {
          headers: { "Authorization": "Bearer " + token } // Non fa nulla ora, ma pronto per API protette
        });
        const dati = await res.json();
        feed.innerHTML = dati.map(post => `
          <div style="margin:15px 0; padding:15px; border:1px solid #ccc; border-radius:8px; background:white;">
            <h3>${post.title}</h3>
            <p>${post.body}</p>
          </div>
        `).join('');
      } catch(err) {
        feed.innerHTML = "<p>Errore nel caricare le informazioni esterne.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await checkAuth();
      caricaFeed();
    });
  </script>
</body>
</html>
