<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Modifica Coppia</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1 id="nomeCoppiaHeader"></h1>

        <label for="titoloIndex">Titolo della Index:</label>
        <input type="text" id="titoloIndex">

        <label for="sfondo">Colore Sfondo:</label>
        <input type="color" id="sfondo">

        <label for="testo">Colore Testo:</label>
        <input type="color" id="testo">

        <label for="font">Font:</label>
        <input type="text" id="font">

        <button id="aggiornaBtn">Aggiorna configurazione</button>

        <div id="msg"></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const coppia = urlParams.get("coppia");

        if (!coppia) {
            alert("Parametro coppia mancante");
        }

        const nomeHeader = document.getElementById("nomeCoppiaHeader");
        const titoloIndexInput = document.getElementById("titoloIndex");
        const sfondoInput = document.getElementById("sfondo");
        const testoInput = document.getElementById("testo");
        const fontInput = document.getElementById("font");

        async function caricaCoppia() {
            const res = await fetch(`/admin/get_coppia?coppia=${coppia}`);
            const data = await res.json();
            if (data.error) {
                alert(data.error);
                return;
            }

            nomeHeader.innerText = data.nome_coppia;
            titoloIndexInput.value = data.titolo_index || "";
            sfondoInput.value = data.colori?.sfondo || "#ffffff";
            testoInput.value = data.colori?.testo || "#000000";
            fontInput.value = data.colori?.font || "Arial";
        }

        document.getElementById("aggiornaBtn").addEventListener("click", async () => {
            const payload = {
                nome_coppia: coppia,
                titolo_index: titoloIndexInput.value,
                colori: {
                    sfondo: sfondoInput.value,
                    testo: testoInput.value,
                    font: fontInput.value
                }
            };

            const res = await fetch("/admin/aggiorna_coppia", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(payload)
            });

            const data = await res.json();
            if (data.success) {
                document.getElementById("msg").innerText = "Configurazione aggiornata!";
                setTimeout(() => {
                    window.location.href = "index.html";
                }, 1000);
            } else {
                document.getElementById("msg").innerText = "Errore aggiornamento";
            }
        });

        caricaCoppia();
    </script>
</body>
</html>
