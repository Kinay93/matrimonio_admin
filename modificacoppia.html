<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Aggiorna Coppia</title>
</head>
<body>
    <h1>Aggiorna Coppia</h1>

    <label for="nomeCoppia">Nome della Coppia:</label>
    <input type="text" id="nomeCoppia" disabled>

    <label for="fotoCoppia">Foto della coppia:</label>
    <input type="file" id="fotoCoppia">

    <label for="titoloIndex">Titolo della pagina:</label>
    <input type="text" id="titoloIndex">

    <label for="colorSfondo">Colore sfondo:</label>
    <input type="color" id="colorSfondo">

    <label for="colorTesto">Colore testo:</label>
    <input type="color" id="colorTesto">

    <button id="aggiornaCoppiaBtn">Aggiorna configurazione</button>

    <div id="msg"></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const coppia = params.get("coppia");

        async function caricaCoppia() {
            const res = await fetch(`https://matrimonioapp.ew.r.appspot.com/config/${coppia}.json`);
            const data = await res.json();

            document.getElementById("nomeCoppia").value = data.nome_coppia;
            document.getElementById("titoloIndex").value = data.titolo_index || "";
            document.getElementById("colorSfondo").value = data.colori?.sfondo || "#ffffff";
            document.getElementById("colorTesto").value = data.colori?.testo || "#000000";
        }

        document.getElementById("aggiornaCoppiaBtn").addEventListener("click", async () => {
            const fotoFile = document.getElementById("fotoCoppia").files[0];

            const formData = new FormData();
            formData.append("nome_coppia", coppia);
            formData.append("titolo_index", document.getElementById("titoloIndex").value);
            formData.append("style_css_colore_sfondo", document.getElementById("colorSfondo").value);
            formData.append("style_css_colore_testo", document.getElementById("colorTesto").value);
            if (fotoFile) formData.append("foto_coppia", fotoFile);

            const res = await fetch('https://matrimonioapp.ew.r.appspot.com/admin/aggiorna_coppia', {
                method: "POST",
                body: formData
            });

            const data = await res.json();
            if (data.success) {
                document.getElementById("msg").innerText = "Coppia aggiornata con successo!";
            } else {
                document.getElementById("msg").innerText = "Errore aggiornamento: " + (data.error || "Imprevisto");
            }
        });

        caricaCoppia();
    </script>
</body>
</html>
