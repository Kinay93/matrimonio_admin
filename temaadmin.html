<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Tema Matrimonio</title>
<style>
/* ---------- RESET BASE ---------- */
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: Arial, sans-serif; background-color:#f9f9f9; color:#333; min-height:100vh; display:flex; flex-direction:column; }
header { background-color:#4a90e2; color:white; padding:1rem; display:flex; justify-content:space-between; align-items:center; }
header h1 { font-size:1.5rem; }
header button { background-color:white; color:#4a90e2; border:none; padding:0.4rem 0.8rem; margin-left:0.5rem; border-radius:5px; cursor:pointer; font-weight:bold; }
header button:hover { opacity:0.9; }
main { flex:1; padding:1rem; }
.preview-area { width:100%; height:200px; border:1px solid #ccc; border-radius:8px; display:flex; justify-content:center; align-items:center; text-align:center; }
select, input[type=color] { margin-bottom:0.5rem; display:block; padding:0.3rem; }
</style>
</head>
<body>

<header>
  <h1>Admin Tema Matrimonio</h1>
</header>

<main>
  <div>
    <label>Colore Sfondo Primario:</label>
    <input type="color" id="bgColor1" value="#ffffff">

    <label>Colore Sfondo Secondario:</label>
    <input type="color" id="bgColor2" value="#eeeeee">

    <label>Colore Testo:</label>
    <input type="color" id="textColor" value="#000000">

    <label>Font:</label>
    <select id="fontSelect"></select>

    <label>Effetto Scritta:</label>
    <select id="effettoScrittaSelect"></select>

    <label>Effetto Sfondo:</label>
    <select id="effettoSfondoSelect"></select>
  </div>

  <div class="preview-area" id="previewArea">
    <span id="previewText">Anteprima Testo</span>
  </div>

  <button id="saveBtn">Salva Tema</button>
</main>

<script>
const fontSelect = document.getElementById("fontSelect");
const effettoScrittaSelect = document.getElementById("effettoScrittaSelect");
const effettoSfondoSelect = document.getElementById("effettoSfondoSelect");
const bgColor1Input = document.getElementById("bgColor1");
const bgColor2Input = document.getElementById("bgColor2");
const textColorInput = document.getElementById("textColor");
const previewArea = document.getElementById("previewArea");
const previewText = document.getElementById("previewText");

let fonts = [];
let effettiScritta = [];
let effettiSfondo = [];

const backendURL = "https://matrimonioapp.ew.r.appspot.com"; // punta al backend su Google Cloud

// ---------- CARICAMENTO FONT ----------
async function caricaFonts() {
    try {
        const res = await fetch(`${backendURL}/admin/get_fonts`);
        const data = await res.json();
        fonts = data.fonts || [];
        fontSelect.innerHTML = "";
        fonts.forEach(f => {
            const option = document.createElement("option");
            option.value = f.css_family;
            option.textContent = f.name;
            fontSelect.appendChild(option);
        });
    } catch(e) { console.error("Errore caricamento fonts:", e); }
}

// ---------- CARICAMENTO EFFETTI ----------
async function caricaEffetti() {
    try {
        const res = await fetch(`${backendURL}/admin/get_effetti`);
        const data = await res.json();
        effettiScritta = data.scritta || [];
        effettiSfondo = data.sfondo || [];

        effettoScrittaSelect.innerHTML = "";
        effettiScritta.forEach(e => {
            const option = document.createElement("option");
            option.value = e.id;
            option.textContent = e.name;
            effettoScrittaSelect.appendChild(option);
        });

        effettoSfondoSelect.innerHTML = "";
        effettiSfondo.forEach(e => {
            const option = document.createElement("option");
            option.value = e.id;
            option.textContent = e.name;
            effettoSfondoSelect.appendChild(option);
        });
    } catch(e) { console.error("Errore caricamento effetti:", e); }
}

// ---------- APPLICA ANTEPRIMA ----------
function aggiornaAnteprima() {
    // Font
    previewText.style.fontFamily = fontSelect.value || "Arial";

    // Colore testo
    previewText.style.color = textColorInput.value;

    // Effetto scritta
    const effScr = effettiScritta.find(e => e.id === effettoScrittaSelect.value);
    previewText.className = "";
    if(effScr) previewText.classList.add(effScr.id);

    // Effetto sfondo
    const effSf = effettiSfondo.find(e => e.id === effettoSfondoSelect.value);
    previewArea.style = "";
    if(effSf) {
        // sostituisci placeholder colori
        let css = effSf.css.replace(/#ffffff/g, bgColor1Input.value)
                           .replace(/#eeeeee/g, bgColor2Input.value);
        previewArea.style.cssText = css;
    } else {
        previewArea.style.backgroundColor = bgColor1Input.value;
    }
}

// ---------- SALVATAGGIO TEMA ----------
async function salvaTema() {
    const formData = new FormData();
    formData.append("bg_color", bgColor1Input.value);
    formData.append("bg_color_secondario", bgColor2Input.value);
    formData.append("text_color", textColorInput.value);
    formData.append("font_family", fontSelect.value);
    formData.append("effetto_scritta", effettoScrittaSelect.value);
    formData.append("effetto_sfondo", effettoSfondoSelect.value);

    const res = await fetch(`${backendURL}/admin/save_theme?admin=default`, {
        method: "POST",
        body: formData
    });
    const data = await res.json();
    if(data.success) alert("Tema salvato!");
    else alert("Errore salvataggio tema");
}

// ---------- EVENT LISTENERS ----------
[fontSelect, effettoScrittaSelect, effettoSfondoSelect, bgColor1Input, bgColor2Input, textColorInput]
    .forEach(el => el.addEventListener("input", aggiornaAnteprima));

document.getElementById("saveBtn").addEventListener("click", salvaTema);

// ---------- INIT ----------
async function init() {
    await caricaFonts();
    await caricaEffetti();
    aggiornaAnteprima();
}

init();
</script>

<style>
/* Effetti scritta CSS */
.corsivo-ombra { font-style: italic; text-shadow: 2px 2px 5px rgba(0,0,0,0.3); }
.grassetto { font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
.ombra-leggera { text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
/* Aggiungi qui gli altri effetti scritta */
</style>

</body>
</html>
