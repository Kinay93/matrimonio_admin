<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestione Tema Admin</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <h1>Gestione Tema Admin</h1>
    <button onclick="window.location.href='index.html'">‚Üê Torna</button>
</header>

<main>
<div class="theme-box">
    <form id="tema-form">
        <label>Colore sfondo</label>
        <input type="color" id="bgColor" name="bgColor"><br><br>

        <label>Colore testo</label>
        <input type="color" id="textColor" name="textColor"><br><br>

        <label>Colore intestazione</label>
        <input type="color" id="headerColor" name="headerColor"><br><br>

        <label>Testo intestazione</label>
        <input type="text" id="headerText" name="headerText" placeholder="Titolo intestazione"><br><br>

        <label>Font</label>
        <select id="fontSelect" name="fontSelect">
            <option value="Arial">Arial</option>
            <option value="Georgia">Georgia</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Verdana">Verdana</option>
        </select><br><br>

        <label>Logo</label>
        <input type="file" id="logoFile" name="logoFile" accept="image/*"><br><br>

        <button type="button" id="saveTema">Salva Tema</button>
    </form>
</div>
</main>

<script src="script.js"></script>
<script>
// Carica il tema esistente se presente
window.onload = () => {
    applicaTemaAdmin(); // funzione in script.js

    // eventuale precompilazione dei campi con i valori attuali
    fetch(`https://matrimonioapp.ew.r.appspot.com/admin/get_theme_latest`)
        .then(r => r.json())
        .then(data => {
            if(data.success && data.theme) {
                document.getElementById('bgColor').value = data.theme.bg_color || '#ffffff';
                document.getElementById('textColor').value = data.theme.text_color || '#000000';
                document.getElementById('headerColor').value = data.theme.header_color || '#000000';
                document.getElementById('headerText').value = data.theme.header_text || '';
                document.getElementById('fontSelect').value = data.theme.font_family || 'Arial';
            }
        });
};

// Salvataggio tema con timestamp JSON
document.getElementById('saveTema').addEventListener('click', async () => {
    const formData = new FormData();
    formData.append("bg_color", document.getElementById('bgColor').value);
    formData.append("text_color", document.getElementById('textColor').value);
    formData.append("header_color", document.getElementById('headerColor').value);
    formData.append("header_text", document.getElementById('headerText').value);
    formData.append("font_family", document.getElementById('fontSelect').value);

    const logoFile = document.getElementById('logoFile').files[0];
    if(logoFile) formData.append("logo", logoFile);

    const res = await fetch(`https://matrimonioapp.ew.r.appspot.com/admin/save_theme`, {
        method: "POST",
        body: formData
    });
    const data = await res.json();
    if(data.success) {
        alert("Tema salvato!");
        window.location.reload();
    } else {
        alert("Errore nel salvataggio tema");
    }
});
</script>
</body>
</html>
