<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Tema Admin</title>
<link rel="stylesheet" href="style.css">
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; display:flex; flex-direction:column; min-height:100vh; }
header { padding:20px; text-align:center; background:#f5f5f5; }
h1 { margin:0; }
.container { display:flex; gap:20px; flex:1; max-width:1000px; margin:40px auto; align-items:flex-start; }
.form-col { flex:1; display:flex; flex-direction:column; gap:15px; }
.form-col label { display:flex; flex-direction:column; font-weight:bold; }
button { padding:8px 12px; cursor:pointer; border:none; border-radius:4px; background:#007BFF; color:white; }
button:hover { background:#0056b3; }
.anteprima-col { flex:1; display:flex; flex-direction:column; align-items:center; gap:10px; }
#anteprimaTema { width:100%; height:300px; display:flex; align-items:center; justify-content:center; border:1px solid #ccc; border-radius:8px; background:#f9f9f9; }
footer { text-align:center; padding:10px; background:#f5f5f5; }
input[type="color"], input[type="text"], select { padding:5px; border-radius:4px; border:1px solid #ccc; }
</style>
</head>
<body>
<header><h1>Gestione Tema Admin</h1></header>

<div class="container">
    <div class="form-col">
        <label>Colore sfondo:<input type="color" id="bgColor" value="#ffffff"></label>
        <label>Colore testo:<input type="color" id="textColor" value="#000000"></label>
        <label>Colore header:<input type="color" id="headerColor" value="#007BFF"></label>
        <label>Testo header:<input type="text" id="headerText" value="Amministrazione Matrimonio"></label>
        <label>Font:<select id="fontSelect"></select></label>
        <label>Logo:<input type="file" id="logoFile"></label>
        <button id="saveTema">Salva Tema</button>
    </div>

    <div class="anteprima-col">
        <h3>Anteprima Tema</h3>
        <div id="anteprimaTema">
            Anteprima colori e font
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
window.onload = async () => { 
    await applicaTemaAdmin();
    caricaFonts();
};

const anteprima = document.getElementById("anteprimaTema");
const bgInput = document.getElementById("bgColor");
const textInput = document.getElementById("textColor");
const headerInput = document.getElementById("headerColor");
const headerTextInput = document.getElementById("headerText");
const fontSelect = document.getElementById("fontSelect");

async function caricaFonts() {
    try {
        const res = await fetch("https://matrimonioapp.ew.r.appspot.com/admin/get_fonts");
        const data = await res.json();
        fontSelect.innerHTML="";
        data.fonts.forEach(f=>{
            const o=document.createElement("option");
            o.value=f; o.textContent=f; o.style.fontFamily=f;
            fontSelect.appendChild(o);
        });
    } catch(e){ console.error(e); }
}

function aggiornaAnteprima() {
    anteprima.style.backgroundColor = bgInput.value;
    anteprima.style.color = textInput.value;
    anteprima.style.fontFamily = fontSelect.value;
    const header = document.querySelector("header h1");
    if(header){
        header.textContent = headerTextInput.value;
        header.style.backgroundColor = headerInput.value;
        header.style.color = textInput.value;
    }
}

[bgInput,textInput,fontSelect,headerTextInput,headerInput].forEach(el=>el.addEventListener("input", aggiornaAnteprima));

document.getElementById("saveTema").addEventListener("click", async ()=>{
    const formData = new FormData();
    formData.append("bg_color", bgInput.value);
    formData.append("text_color", textInput.value);
    formData.append("header_color", headerInput.value);
    formData.append("header_text", headerTextInput.value);
    formData.append("font_family", fontSelect.value);
    const logoFile = document.getElementById("logoFile").files[0];
    if(logoFile) formData.append("logo", logoFile);
    const res = await fetch("https://matrimonioapp.ew.r.appspot.com/admin/save_theme",{method:"POST",body:formData});
    const data = await res.json();
    alert(data.success?"Tema salvato!":"Errore salvataggio tema");
});
</script>

<footer>
    <a href="index.html" class="pulsante">Menu</a>
</footer>
</body>
</html>
