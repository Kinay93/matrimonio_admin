<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Tema Matrimonio</title>
<link rel="stylesheet" href="style.css">
<style>
    .preview-box {
        padding: 1rem;
        border-radius: 8px;
        margin-top: 1rem;
        text-align: center;
        min-height: 150px;
    }
</style>
</head>
<body>
<header>
    <h1>Admin Tema Matrimonio</h1>
</header>

<main>
    <div class="two-columns">
        <div class="form-box">
            <h2>Configurazione Tema</h2>
            <form id="themeForm">
                <label>Colore Sfondo Primario:</label>
                <input type="color" id="bgColor" name="bg_color"><br><br>

                <label>Colore Sfondo Secondario:</label>
                <input type="color" id="bgColorSecondario" name="bg_color_secondario"><br><br>

                <label>Colore Testo:</label>
                <input type="color" id="textColor" name="text_color"><br><br>

                <label>Colore Header:</label>
                <input type="color" id="headerColor" name="header_color"><br><br>

                <label>Testo Header:</label>
                <input type="text" id="headerText" name="header_text"><br><br>

                <label>Font:</label>
                <select id="fontSelect" name="font_family"></select><br><br>

                <label>Effetto Scritta:</label>
                <select id="effettiScrittaSelect" name="effetto_scritta"></select><br><br>

                <label>Effetto Sfondo:</label>
                <select id="effettiSfondoSelect" name="effetto_sfondo"></select><br><br>

                <label>Logo:</label>
                <input type="file" id="logoFile" name="logo"><br><br>

                <button type="submit">Salva Tema</button>
            </form>
        </div>

        <div class="preview-box" id="previewBox">
            Anteprima Tema
        </div>
    </div>
</main>

<script>
const fontSelect = document.getElementById("fontSelect");
const effettiScrittaSelect = document.getElementById("effettiScrittaSelect");
const effettiSfondoSelect = document.getElementById("effettiSfondoSelect");

const bgColorInput = document.getElementById("bgColor");
const bgColorSecondarioInput = document.getElementById("bgColorSecondario");
const textColorInput = document.getElementById("textColor");
const headerColorInput = document.getElementById("headerColor");
const headerTextInput = document.getElementById("headerText");
const previewBox = document.getElementById("previewBox");

async function caricaFonts() {
    try {
        const res = await fetch("https://matrimonioapp.ew.r.appspot.com/admin/get_fonts");
        const data = await res.json();
        fontSelect.innerHTML = "";
        data.fonts.forEach(f => {
            const opt = document.createElement("option");
            opt.value = f.css_family;
            opt.textContent = f.name;
            fontSelect.appendChild(opt);
        });
    } catch(e) { console.error(e); }
}

async function caricaEffetti() {
    try {
        const res = await fetch("https://matrimonioapp.ew.r.appspot.com/admin/get_effetti");
        const data = await res.json();

        effettiScrittaSelect.innerHTML = "";
        data.scritta.forEach(e => {
            const opt = document.createElement("option");
            opt.value = e.id;
            opt.textContent = e.name;
            effettiScrittaSelect.appendChild(opt);
        });

        effettiSfondoSelect.innerHTML = "";
        data.sfondo.forEach(e => {
            const opt = document.createElement("option");
            opt.value = e.id;
            opt.textContent = e.name;
            effettiSfondoSelect.appendChild(opt);
        });
    } catch(e) { console.error(e); }
}

function aggiornaAnteprima() {
    const bg = bgColorInput.value;
    const bg2 = bgColorSecondarioInput.value;
    const txt = textColorInput.value;
    const font = fontSelect.value;
    const effettoScritta = effettiScrittaSelect.value;
    const effettoSfondo = effettiSfondoSelect.value;

    previewBox.style.background = bg;
    previewBox.style.color = txt;
    previewBox.style.fontFamily = font;
    previewBox.style.boxShadow = effettoSfondo ? "0 0 20px " + bg2 : "none";
    previewBox.textContent = effettoScritta ? "Testo con effetto: " + effettoScritta : "Anteprima Tema";
}

bgColorInput.addEventListener("input", aggiornaAnteprima);
bgColorSecondarioInput.addEventListener("input", aggiornaAnteprima);
textColorInput.addEventListener("input", aggiornaAnteprima);
fontSelect.addEventListener("change", aggiornaAnteprima);
effettiScrittaSelect.addEventListener("change", aggiornaAnteprima);
effettiSfondoSelect.addEventListener("change", aggiornaAnteprima);

document.getElementById("themeForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const res = await fetch("https://matrimonioapp.ew.r.appspot.com/admin/save_theme", {
        method: "POST",
        body: formData
    });
    const data = await res.json();
    if(data.success) alert("Tema salvato!");
    else alert("Errore salvataggio");
});

async function caricaTema() {
    const res = await fetch("https://matrimonioapp.ew.r.appspot.com/admin/get_theme");
    const data = await res.json();
    if(!data.success) return;
    const conf = data.config;

    bgColorInput.value = conf.bg_color || "#ffffff";
    bgColorSecondarioInput.value = conf.bg_color_secondario || "#ffffff";
    textColorInput.value = conf.text_color || "#000000";
    headerColorInput.value = conf.header_color || "#007BFF";
    headerTextInput.value = conf.header_text || "Header di esempio";
    fontSelect.value = conf.font_family || "Arial";
    effettiScrittaSelect.value = conf.effetto_scritta || "";
    effettiSfondoSelect.value = conf.effetto_sfondo || "";

    aggiornaAnteprima();
}

async function init() {
    await caricaFonts();
    await caricaEffetti();
    await caricaTema();
}

init();
</script>
</body>
</html>
