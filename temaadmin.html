<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Tema Admin</title>
<link rel="stylesheet" href="style.css">
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; display:flex; flex-direction:column; min-height:100vh; }
header { padding:20px; text-align:center; background:#f5f5f5; }
h1 { margin:0; }
.container { display:flex; gap:20px; flex:1; max-width:1000px; margin:40px auto; align-items:flex-start; }
.form-col { flex:1; display:flex; flex-direction:column; gap:15px; }
.form-col label { display:flex; flex-direction:column; font-weight:bold; }
button { padding:8px 12px; cursor:pointer; border:none; border-radius:4px; background:#007BFF; color:white; }
button:hover { background:#0056b3; }
.anteprima-col { flex:1; display:flex; flex-direction:column; align-items:center; gap:10px; }
#anteprimaTema { width:100%; height:300px; display:flex; align-items:center; justify-content:center; border:1px solid #ccc; border-radius:8px; background:#f9f9f9; transition: all 0.3s ease; }
footer { text-align:center; padding:10px; background:#f5f5f5; }
input[type="color"], input[type="text"], select { padding:5px; border-radius:4px; border:1px solid #ccc; }
</style>
</head>
<body>
<header><h1>Gestione Tema Admin</h1></header>

<div class="container">
    <div class="form-col">
        <label>Colore sfondo:<input type="color" id="bgColor" value="#ffffff"></label>
        <label>Colore testo:<input type="color" id="textColor" value="#000000"></label>
        <label>Colore header:<input type="color" id="headerColor" value="#007BFF"></label>
        <label>Testo header:<input type="text" id="headerText" value="Amministrazione Matrimonio"></label>
        <label>Font:<select id="fontSelect"></select></label>
        <label>Effetto scritta:<select id="effettiScrittaSelect"></select></label>
        <label>Effetto sfondo:<select id="effettiSfondoSelect"></select></label>
        <label>Logo:<input type="file" id="logoFile"></label>
        <button id="saveTema">Salva Tema</button>
    </div>

    <div class="anteprima-col">
        <h3>Anteprima Tema</h3>
        <div id="anteprimaTema">
            Anteprima colori e font
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
window.onload = async () => { 
    await applicaTemaAdmin();
    await caricaFonts();
    await caricaEffettiScritta();
    await caricaEffettiSfondo();
};

const anteprima = document.getElementById("anteprimaTema");
const bgInput = document.getElementById("bgColor");
const textInput = document.getElementById("textColor");
const headerInput = document.getElementById("headerColor");
const headerTextInput = document.getElementById("headerText");
const fontSelect = document.getElementById("fontSelect");
const effettiScrittaSelect = document.getElementById("effettiScrittaSelect");
const effettiSfondoSelect = document.getElementById("effettiSfondoSelect");

// --- Caricamento Font ---
async function caricaFonts() {
    try {
        const res = await fetch("https://storage.googleapis.com/matrimonio_app_bucket/config/fonts/fonts.json", { mode: "cors" });
        if(!res.ok) throw new Error("Errore fetch fonts");
        const fonts = await res.json();

        fontSelect.innerHTML = "";
        fonts.forEach(f => {
            const option = document.createElement("option");
            option.value = f.css_family;
            option.textContent = f.name;
            option.style.fontFamily = f.css_family;
            fontSelect.appendChild(option);
        });
        if(fontSelect.options.length > 0) fontSelect.value = fonts[0].css_family;
        aggiornaAnteprima();
    } catch(e) { console.error("Errore caricamento fonts:", e); }
}

// --- Caricamento Effetti Scritta ---
async function caricaEffettiScritta() {
    try {
        const res = await fetch("https://storage.googleapis.com/matrimonio_app_bucket/config/effetti_scritta/effetti_scritta.json", { mode: "cors" });
        if(!res.ok) throw new Error("Errore fetch effetti scritta");
        const effetti = await res.json();

        effettiScrittaSelect.innerHTML = "";
        effetti.forEach(eff => {
            const option = document.createElement("option");
            option.value = eff.id;
            option.textContent = eff.name;
            effettiScrittaSelect.appendChild(option);
        });
        if(effettiScrittaSelect.options.length > 0) effettiScrittaSelect.value = effetti[0].id;
        aggiornaAnteprima();
    } catch(e) { console.error("Errore caricamento effetti scritta:", e); }
}

// --- Caricamento Effetti Sfondo ---
async function caricaEf
