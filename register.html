<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Registrazione</title>
<style>
/* ---------- BODY & CONTAINER ---------- */
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: #E0FBFC;
    color: #023E3B;
}

.container {
    background: white;
    padding: 30px 40px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
    display: flex;
    flex-direction: column;
}

/* ---------- HEADER ---------- */
header {
    background-color: #2EC4B6;
    color: white;
    text-align: center;
    padding: 15px;
    border-radius: 15px 15px 0 0;
    font-size: 1.5em;
    font-weight: bold;
}

/* ---------- FORM ---------- */
h2 { text-align: center; margin: 20px 0 15px; }

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input[type="email"], input[type="password"], input[type="text"] {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    transition: 0.2s;
}

input:focus {
    border-color: #2EC4B6;
    outline: none;
    box-shadow: 0 0 5px #2EC4B6;
}

/* ---------- BUTTON ---------- */
button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

#registerBtn {
    background-color: #2EC4B6;
    color: white;
}

#registerBtn:hover {
    background-color: #27a19a;
}

/* ---------- MESSAGGI ---------- */
#msg {
    text-align: center;
    margin-bottom: 10px;
    font-weight: bold;
    color: #FF6B6B;
}

/* ---------- SOCIAL BUTTONS ---------- */
.social-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
}

.social-btn button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px;
    font-size: 14px;
    border-radius: 8px;
    color: white;
}

.social-btn button.google { background: #DB4437; }
.social-btn button.facebook { background: #3B5998; }
.social-btn button:hover { opacity: 0.9; }

/* ---------- FOOTER ---------- */
footer {
    margin-top: 15px;
    text-align: center;
    font-size: 0.9em;
}

footer a {
    color: #2EC4B6;
    text-decoration: none;
    font-weight: bold;
    transition: 0.2s;
}

footer a:hover { text-decoration: underline; }

@media (max-width:480px){ .container{padding:20px;} }
</style>
</head>
<body>
<div class="container">
<header>Registrazione</header>
<div id="msg"></div>
<form id="registerForm">
    <label for="nome">Nome</label>
    <input type="text" id="nome" required>
    <label for="cognome">Cognome</label>
    <input type="text" id="cognome" required>
    <label for="username">Username</label>
    <input type="text" id="username" required>
    <label for="email">Email</label>
    <input type="email" id="email" required>
    <label for="password">Password</label>
    <input type="password" id="password" required>
    <label for="confirmPassword">Conferma Password</label>
    <input type="password" id="confirmPassword" required>

    <!-- ---------- RUOLO ---------- -->
    <fieldset>
        <legend>Ruolo</legend>
        <label><input type="radio" name="ruolo" value="Fotografo" required> Fotografo</label>
        <label><input type="radio" name="ruolo" value="Musicista"> Musicista</label>
        <label><input type="radio" name="ruolo" value="Wedding Planner"> Wedding Planner</label>
        <label><input type="radio" name="ruolo" value="Organizzatore Eventi"> Organizzatore Eventi</label>
    </fieldset>

    <button type="submit" id="registerBtn">Registrati</button>
</form>
<div class="social-btn">
    <button class="google" id="googleBtn"><img src="https://img.icons8.com/color/20/000000/google-logo.png"/> Google</button>
    <button class="facebook" id="facebookBtn"><img src="https://img.icons8.com/color/20/000000/facebook-new.png"/> Facebook</button>
</div>
<footer>Hai gi√† un account? <a href="login.html">Accedi qui</a></footer>
</div>

<script>
const registerForm = document.getElementById('registerForm');
const msg = document.getElementById('msg');

registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.style.color = '#FF6B6B';

    const nome = document.getElementById('nome').value.trim();
    const cognome = document.getElementById('cognome').value.trim();
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    // Ruolo selezionato (solo uno)
    const ruoloEl = document.querySelector('input[name="ruolo"]:checked');
    if(!ruoloEl){
        msg.textContent = "Seleziona un ruolo!";
        return;
    }
    const ruolo = ruoloEl.value;

    if(password !== confirmPassword){
        msg.textContent = "Le password non coincidono!";
        return;
    }

    try {
        const response = await fetch("https://matrimonioapp.ew.r.appspot.com/register", {
            method: "POST",
            credentials: "include",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({nome, cognome, username, email, password, ruolo})
        }).then(res => res.json());

        if(response.success){
            localStorage.setItem("auth_token", response.token);
            msg.style.color = 'green';
            msg.textContent = "Registrazione avvenuta con successo!";
            setTimeout(()=>window.location.href='login.html', 1500);
        } else {
            msg.textContent = response.error || "Errore imprevisto";
        }
    } catch(err){
        msg.textContent = "Errore di connessione";
    }
});

// Social buttons
document.getElementById('googleBtn').addEventListener('click', ()=>{ window.location.href = "/login/google"; });
document.getElementById('facebookBtn').addEventListener('click', ()=>{ window.location.href = "/login/facebook"; });
</script>
</body>
</html>
