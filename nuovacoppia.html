<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Nuova Coppia</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <div class="form-col">
    <h1>Nuovo Matrimonio</h1>
    <label for="nomeCoppia">Nome della Coppia:</label>
    <input type="text" id="nomeCoppia" placeholder="Inserisci nome coppia">
    <label for="fotoCoppia">Foto della coppia:</label>
    <input type="file" id="fotoCoppia">
    <label for="colorSfondo">Colore sfondo:</label>
    <input type="color" id="colorSfondo" value="#ffffff">
    <label for="colorTesto">Colore testo:</label>
    <input type="color" id="colorTesto" value="#000000">
    <label for="fontScelto">Font del testo:</label>
    <select id="fontScelto"></select>
    <label for="effettoSfondo">Effetto Sfondo:</label>
    <select id="effettoSfondo"></select>
    <label for="effettoScritta">Effetto Scritta:</label>
    <select id="effettoScritta"></select>
    <button id="creaCoppiaBtn">Crea coppia</button>
    <div id="msg"></div>
  </div>

  <div class="preview-col">
    <h3>Anteprima</h3>
    <div id="anteprima">
      <div id="anteprimaFoto">Foto</div>
      <span id="anteprimaTesto">Titolo Coppia</span>
    </div>
  </div>
</div>

<script src="script.js"></script>
<script>
window.addEventListener("DOMContentLoaded", async () => {
    if (typeof applicaTemaAdmin === "function") await applicaTemaAdmin();

    const anteprimaDiv = document.getElementById("anteprima");
    const anteprimaTesto = document.getElementById("anteprimaTesto");
    const anteprimaFoto = document.getElementById("anteprimaFoto");
    const inputSfondo = document.getElementById("colorSfondo");
    const inputTesto = document.getElementById("colorTesto");
    const selectFont = document.getElementById("fontScelto");
    const selectEffettoSfondo = document.getElementById("effettoSfondo");
    const selectEffettoScritta = document.getElementById("effettoScritta");

    function aggiornaAnteprima() {
        anteprimaDiv.style.backgroundColor = inputSfondo.value;
        anteprimaTesto.style.color = inputTesto.value;
        anteprimaTesto.style.fontFamily = selectFont.value;
    }

    [inputSfondo, inputTesto].forEach(e => e.addEventListener("input", aggiornaAnteprima));
    [selectFont, selectEffettoSfondo, selectEffettoScritta].forEach(e => e.addEventListener("change", aggiornaAnteprima));

    await caricaFontsEdEffetti(selectFont, selectEffettoSfondo, selectEffettoScritta);
    aggiornaAnteprima();

    document.getElementById("creaCoppiaBtn").addEventListener("click", async () => {
        const nome = document.getElementById("nomeCoppia").value.trim();
        const fotoFile = document.getElementById("fotoCoppia").files[0];

        if (!nome) return alert("Inserisci un nome per la coppia");
        if (!fotoFile) return alert("Seleziona una foto della coppia");

        const formData = new FormData();
        formData.append("nome_coppia", nome);
        formData.append("foto_coppia", fotoFile);
        formData.append("style_css_colore_sfondo", inputSfondo.value);
        formData.append("style_css_colore_testo", inputTesto.value);
        formData.append("style_css_font", selectFont.value);
        formData.append("effetto_sfondo", selectEffettoSfondo.value);
        formData.append("effetto_scritta", selectEffettoScritta.value);

        const res = await fetch('https://matrimonioapp.ew.r.appspot.com/admin/crea_coppia', {
            method: "POST",
            body: formData
        });
        const data = await res.json();
        document.getElementById("msg").innerText = data.success ? "Coppia creata con successo!" : "Errore: " + (data.error || "Imprevisto");
        if (data.success) setTimeout(()=>window.location.href="index.html", 1000);
    });
});
</script>
</body>
</html>
