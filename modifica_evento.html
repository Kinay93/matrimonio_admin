<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modifica Evento</title>
  <link rel="stylesheet" href="style.css">
  <script src="navbar.js" defer></script>
  <script src="script.js" defer></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .container {
      display: flex;
      flex: 1;
      height: 100vh;
      overflow: hidden;
    }

    .form-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid #ccc;
      box-sizing: border-box;
    }

    .anteprima-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      position: sticky;
      top: 0;
      height: 100vh;
      box-sizing: border-box;
    }

    #anteprima {
      width: 80%;
      height: 80%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ccc;
      margin-top: 20px;
      position: relative;
      max-width: 400px;
      max-height: 400px;
    }

    #anteprimaFoto {
      width: 150px;
      height: 150px;
      background-color: #ddd;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #666;
      overflow: hidden;
    }

    #anteprimaFoto img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #anteprimaTesto {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 24px;
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      padding: 10px;
      background-color: rgba(255,255,255,0.9);
      box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
    }

    footer a {
      text-decoration: none;
      background: #c235d4;
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: bold;
      transition: background 0.2s ease;
    }

    footer a:hover {
      background: #a91eb9;
    }

    @media (max-width: 1024px) {
      .container { flex-direction: column; height: 100vh; }
      .anteprima-col { width: 100%; height: 40vh; position: fixed; top: 0; left: 0; right: 0; background: white; z-index: 1000; border-bottom: 1px solid #ccc; }
      .form-col { margin-top: 40vh; flex: 1; overflow-y: auto; border-right: none; border-bottom: 1px solid #ccc; }
      #anteprima { width: 80%; height: 80%; max-width: none; max-height: none; }
    }

    @media (max-width: 480px) {
      .anteprima-col { height: 35vh; }
      .form-col { margin-top: 35vh; }
    }

    @media (max-width: 768px) {
      footer { flex-direction: column; gap: 10px; }
      footer a { width: 80%; text-align: center; }
    }
  </style>
</head>
<body>
  <div id="navbar-placeholder"></div>

  <div class="container">
    <div class="form-col">
      <label>Nome evento:<input type="text" id="nomeEvento" disabled></label>
      <label>Foto evento:<input type="file" id="fotoEvento"></label>
      <label>Colore sfondo primario:<input type="color" id="sfondo"></label>
      <label>Colore sfondo secondario:<input type="color" id="sfondoSecondario"></label>
      <label>Colore testo:<input type="color" id="testo"></label>
      <label>Font:<select id="font"></select></label>
      <label>Effetto sfondo:<select id="effettoSfondo"></select></label>
      <label>Effetto scritta:<select id="effettoScritta"></select></label>
      <button id="aggiornaEventoBtn">Aggiorna evento</button>
      <div id="msg"></div>
    </div>

    <div class="anteprima-col">
      <h3>Anteprima</h3>
      <div id="anteprima">
        <div id="anteprimaFoto">Foto</div>
        <span id="anteprimaTesto">Titolo Evento</span>
      </div>
    </div>
  </div>

  <footer>
    <a href="index.html" id="home-btn">Home</a>
  </footer>
  <script>
let anteprimaDiv, anteprimaTesto;
let inputSfondo, inputSfondoSecondario, inputTesto, selectFont, selectEffettoScritta, selectEffettoSfondo;

// Utility per convertire HEX â†’ RGB
function hexToRgb(hex) {
  if (!hex) return "255,255,255";
  hex = hex.replace("#", "");
  if (hex.length === 3) {
    hex = hex.split("").map(c => c + c).join("");
  }
  const bigint = parseInt(hex, 16);
  const r = (bigint >> 16) & 255;
  const g = (bigint >> 8) & 255;
  const b = bigint & 255;
  return `${r},${g},${b}`;
}

// --- Funzione aggiorna anteprima
function aggiornaAnteprima() {
  const bg1 = inputSfondo.value || "#ffffff";
  const bg2 = inputSfondoSecondario.value || bg1;
  const textColor = inputTesto.value || "#000";

  // Reset stili
  anteprimaDiv.style = "";
  anteprimaTesto.style = "";

  // Font e colore base
  anteprimaTesto.style.color = textColor;
  anteprimaTesto.style.fontFamily = selectFont.value || "Arial";

  // --- Effetto Scritta
  const effScritta = effettiScritta.find(e => String(e.id) === String(selectEffettoScritta.value));
  if (effScritta && effScritta.css) {
    effScritta.css.split(";").forEach(rule => {
      if (!rule.trim()) return;
      const [propRaw, ...valParts] = rule.split(":");
      const prop = propRaw && propRaw.trim();
      const val = valParts.join(":") && valParts.join(":").trim();
      if (prop && val) {
        anteprimaTesto.style.setProperty(prop, val.replace(/var\(--text-color\)/g, textColor));
      }
    });
  }

  // --- Effetto Sfondo
  const effSfondo = effettiSfondo.find(e => String(e.id) === String(selectEffettoSfondo.value));
  if (effSfondo && effSfondo.css) {
    let css = effSfondo.css
      .replace(/var\(--bg-color\)/g, bg1)
      .replace(/var\(--bg-color-rgb\)/g, hexToRgb(bg1))
      .replace(/var\(--bg-color-secondario\)/g, bg2)
      .replace(/var\(--bg-color-secondario-rgb\)/g, hexToRgb(bg2));

    css.split(";").forEach(rule => {
      if (!rule.trim()) return;
      const [propRaw, ...valParts] = rule.split(":");
      const prop = propRaw && propRaw.trim();
      const val = valParts.join(":") && valParts.join(":").trim();
      if (prop && val) {
        anteprimaDiv.style.setProperty(prop, val);
      }
    });
  } else {
    // fallback semplice
    anteprimaDiv.style.background = `linear-gradient(135deg, ${bg1} 0%, ${bg2} 100%)`;
  }
}

// --- Onload
window.addEventListener("DOMContentLoaded", () => {
  anteprimaDiv = document.getElementById("anteprima");
  anteprimaTesto = document.getElementById("anteprima-testo");
  inputSfondo = document.getElementById("sfondo");
  inputSfondoSecondario = document.getElementById("sfondo-secondario");
  inputTesto = document.getElementById("testo");
  selectFont = document.getElementById("font");
  selectEffettoScritta = document.getElementById("effetto-scritta");
  selectEffettoSfondo = document.getElementById("effetto-sfondo");

  // Listener
  [inputSfondo, inputSfondoSecondario, inputTesto, selectFont, selectEffettoScritta, selectEffettoSfondo]
    .forEach(el => el && el.addEventListener("input", aggiornaAnteprima));

  aggiornaAnteprima();
});
</script>
</body>
</html>
